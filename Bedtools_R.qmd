# Introducci√≥n a BEDtools en R üß¨

## üíª 

Este documento proporciona una gu√≠a b√°sica para trabajar con **R**, **Bedtools**, y archivos gen√≥micos.\
Incluye:

-   Preparaci√≥n del ambiente
-   Comandos esenciales de Bedtools
-   Lectura y manipulaci√≥n de BED/GFF en R
-   Ejemplos pr√°cticos

------------------------------------------------------------------------

## üì¶ Cargar paquetes

::: callout-note
`{r} # Instalar paquetes si es la primera vez  install.packages(c("readr", "dplyr", "ggplot2"))`

`#Cargar de librer√≠as necesarias:`

`library(readr) # Lectura de archivos (TSV, CSV, texto) library(dplyr) # Manipulaci√≥n de datos (pipes, mutate, filter‚Ä¶) library(ggplot2) # Gr√°ficos (histogramas, dispersi√≥n, boxplots)`
:::

### Recordemos lo siguiente:

::: callout-note
üìå Descripci√≥n de las columnas del resumen de genes

A continuaci√≥n se explica el significado de cada columna generada en el an√°lisis:

-   **chrom**\
    Cromosoma donde se encuentra el gen (por ejemplo: *chr1*, *chr2*, *chrX*).

-   **start**\
    Posici√≥n inicial del gen en el cromosoma (coordenadas gen√≥micas en formato BED).

-   **end**\
    Posici√≥n final del gen en el cromosoma.

-   **gene_id**\
    Identificador √∫nico del gen (por ejemplo: ENSG00000123456 o el nombre del gen).

-   **number_of_peaks**\
    N√∫mero total de picos que intersectan el gen.\
    Se refiere a cu√°ntas regiones (por ejemplo, ATAC-seq o ChIP-seq) se solapan con el gen.

-   **bases_overlapped**\
    Cantidad de bases (nucle√≥tidos) dentro del gen que est√°n cubiertas por picos.\
    Resume cu√°nto del gen est√° siendo ‚Äútocado‚Äù por regiones de inter√©s.
:::

###  Lectura de archivos generados por Bedtools

#### Archivo de **coverage**

::: callout-note
`#Leer archivo obtenido con bedtools coverage`

`coverage <- read.delim(file = "Archivos_Bash/genes_coverage.tsv", col.names = c("chrom",            # Cromosoma"start",            # Inicio del gen"end",              # Fin del gen"gene_id",          # ID del gen"number_of_peaks",  # N√∫mero de picos que intersectan el gen"bases_overlapped", # N√∫mero total de bases cubiertas por picos"gene_length",      # Longitud total del gen"fraction_covered"  # Proporci√≥n cubierta por picos))`

`#Vista general del objeto cargado`

`glimpse(coverage)head(coverage)`
:::

### Archivo de **intersect** (bedtools intersect -wa)

::: callout-note
`#Leer archivo de intersecciones (solo genes con al menos un pico)intersect_genes <- read.delim("Archivos_Bash/genes_peaks_intersect.bed", col.names = c("chrom", "start", "end", "gene_id"))`

`#vista general del objeto cargado`

`glimpse(intersect_genes) head(intersect_genes)`
:::

### üß™ Chequeos de consistencia

Validar la fracci√≥n cubierta

::: callout-note
`coverage_check <- coverage %>%mutate(fraction_calc = bases_overlapped / gene_length,        # Recalcular fracci√≥ndiff_fraction = abs(fraction_calc - fraction_covered)  # Comparar con la reportada)`

`#Si todo est√° bien, los valores deber√≠an ser cercanos a 0summary(coverage_check$diff_fraction)`
:::

### Genes con y sin picos (seg√∫n coverage)

::: callout-note
`coverage %>% summarise(total_genes = n(),          # N√∫mero total de genesgenes_con_picos = sum(number_of_peaks > 0),    # Genes con ‚â•1 picogenes_sin_picos = sum(number_of_peaks == 0)    # Genes sin picos)`
:::

### Verificar consistencia del archivo intersect

::: callout-note
`intersect_genes %>% summarise( genes_intersect_unicos = n_distinct(gene_id),  # Cu√°ntos genes aparecen al menos una vezfilas_intersect = n()                          # N√∫mero total de filas (varios picos por gen))`
:::

### Cruzar coverage con intersect para validar

A√±adir columna indicando si un gen aparece en intersect

::: callout-note
`coverage_validado <- coverage %>%mutate(en_intersect = gene_id %in% intersect_genes$gene_id)`
:::

### Comparar consistencia entre ambos archivos

::: callout-note
`coverage_validado %>%count(number_of_peaks > 0, en_intersect) %>%rename(tiene_picos_seg√∫n_coverage = number_of_peaks > 0)`
:::

(Idealmente, genes con picos seg√∫n coverage deben estar presentes en intersect).

### Exploraci√≥n visual y estad√≠stica b√°sica

::: callout-note
`#Histograma de fracci√≥n cubiertaggplot(coverage, aes(x = fraction_covered)) +geom_histogram(bins = 50) +labs( title = "Distribuci√≥n de la fracci√≥n de cobertura por gen",x = "Fracci√≥n cubierta",y = "N√∫mero de genes")`
:::

### Resumen de cobertura por grupo (con vs sin picos)

::: callout-note
coverage %\>%\
mutate(tiene_picos = number_of_peaks \> 0) %\>%\
group_by(tiene_picos) %\>%\
summarise(\
n_genes = n(),\
mediana_fraccion = median(fraction_covered),\
promedio_fraccion = mean(fraction_covered),\
max_fraccion = max(fraction_covered)\
)
:::

### Boxplot de fracci√≥n cubierta 

::: callout-note
`coverage %>%mutate(tiene_picos = ifelse(number_of_peaks > 0, "Con picos", "Sin picos")) %>%ggplot(aes(x = tiene_picos, y = fraction_covered)) +geom_boxplot() +labs(title = "Cobertura de picos por gen",x = "Grupo de genes",y = "Fracci√≥n cubierta")`
:::

## Referencias

-   Bedtools manual [https://bedtools.readthedocs.io/](https://bedtools.readthedocs.io/?utm_source=chatgpt.com)
-   Bioconductor: GenomicRanges, rtracklayer <https://bioconductor.org/packages/release/bioc/html/rtracklayer.html>
-   UCSC Genome Browser formatos <https://genome.ucsc.edu/>
